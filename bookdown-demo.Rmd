--- 
title: "A Minimal Book Example"
author: "Sara Haman, Adam Lashley, Reilly Stanton, Benjamin Weisman"
date: "`r Sys.Date()`"
site: bookdown::bookdown_site
output: bookdown::gitbook
output_dir: "docs"
documentclass: book
bibliography: [book.bib, packages.bib]
biblio-style: apalike
link-citations: yes~
github-repo: benjaminweisman/Data-Munging
description: "An analysis of data from the College Scorecard API, which focuses on differences identified between institutions with R1 and R2 carnegie classifications. This project was completed to satisfy the requirements of a project assigned to students in the Fall 2020 Data Munging and Exploratory Data Analysis at New College of Florida."
---

# Preface {-}

```{r include=FALSE}
# automatically create a bib database for R packages
knitr::write_bib(c(
  .packages(), 'bookdown', 'knitr', 'rmarkdown'
), 'packages.bib')
```

<!--chapter:end:index.Rmd-->

# Introduction {#intro}

You can label chapter and section titles using `{#label}` after them, e.g., we can reference Chapter \@ref(intro). If you do not manually label them, there will be automatic labels anyway, e.g., Chapter \@ref(methods).

Figures and tables with captions will be placed in `figure` and `table` environments, respectively.

```{r nice-fig, fig.cap='Here is a nice figure!', out.width='80%', fig.asp=.75, fig.align='center'}
par(mar = c(4, 4, .1, .1))
plot(pressure, type = 'b', pch = 19)
```

Reference a figure by its code chunk label with the `fig:` prefix, e.g., see Figure \@ref(fig:nice-fig). Similarly, you can reference tables generated from `knitr::kable()`, e.g., see Table \@ref(tab:nice-tab).

```{r nice-tab, tidy=FALSE}
knitr::kable(
  head(iris, 20), caption = 'Here is a nice table!',
  booktabs = TRUE
)
```

You can write citations, too. For example, we are using the **bookdown** package [@R-bookdown] in this sample book, which was built on top of R Markdown and **knitr** [@xie2015].

<!--chapter:end:01-intro.Rmd-->

# Data Acquisition

```{r, message = FALSE}
library(plyr)
library(tidyverse)
library(Hmisc)
library(httr)
library(jsonlite)
#install.packages("tmap")
library(tmap)
library(leaflet)
library(treemap)
library(kableExtra)

`%notin%` <- Negate(`%in%`)

MakePretty <- function(x) {
  x %>% kbl(align = "c") %>% kable_material()
}
```

## Set-up and API Exploration

For our project, we wanted to practice using API to pass the data into our global environment and attempt to explore and extract our desired variables using base R.

As you will see, our attempt failed, but was useful in helping us understand the relational structure of the College Scorecard Data and the limits of simple indexing when dealing with complicated data structures. 

### Project Directory Management

Prior to extracting any of the data, we want to ensure that our project is reproducible. Thus, we first create a sub-directory within the user's working directory, which will hold the .csv files we will write containing our variables of interest.

```{r dir-setup}
proj.dir <- getwd()
#dir.create("Proj1Data")
data.dir <- paste0(proj.dir, "/Proj1Data")
```

Next, we pass the API key into an object so that it can be called in the `GET()` function, which pulls the data from the API into out global environment.

```{r api-setup}
APIKey = "FELgrGb47PaevTWxqZTt6etFaQVnDbKpcJLaPL6a"
res = GET(paste0("https://api.data.gov/ed/collegescorecard/v1/schools?api_key=", APIKey))
```

This data is initially in a `raw` format that is pulled from a JSON file stored on the API servers. To do this, we first convert the `raw` data to `char` and call the `fromJSON()` function to convert the data to a more "R friendly" data structure.

```{r data-setup}
data = fromJSON(rawToChar(res$content))
is(data)
```
Now that this raw JSON file is converted to a list, we can begin our exploration of the data.

### API Exploration

We originally intended on using `list2env(yearsLi, envir = .GlobalEnv)` to split the list into multiple `data.frame` objects, but the fact that the names of the listed data frames are numeric values will be a problem. When calling these data frames, R will have to decide whether the user input `r 2012` is calling the `data$2012` data set, or the number `2012`. This is likely to cause problems in our later analysis, so we have to look at the `names()` of objects in our `data` list to see how we might adjust our approach to exploring the data. 

```{r data-names}
names(data$results)
```

Upon looking at the `names()` we noticed that not all of the listed data frames are named after years, and thus are likely contain different data than the others. 

Therefore, we first extract the non-year data frames, prior to extracting the year data frames with a character alteration (to make them non-numeric), 

```{r data-subset}
id_data <- data$results[c("school", "id", "location", "ope6_id", "ope8_id")]

yearsLi<- data$results[names(data$results) %notin% c("school", "id", "location", "ope6_id", "ope8_id")]

names(yearsLi) <- paste0("yr", names(yearsLi))

#list2env(yearsLi, envir = .GlobalEnv)
```

At this point, we then called `list2env(data$results, envir = .GlobalEnv)` to create individual dataframes of each object in the `yearsLi` list, which helped us understand what was happening at different levels of the data structure, but ultimately left us more confused about how we should approach querying this data. 

This code, as well as the code we used to analyze these objects below, is commented it out because it creates an unnecessary number of objects in the global environment, but retained in this document to show the attempts we made at exploring the data structure.
```{r}
#
#names(yr2012)
#contents(id_data$school)
#contents(yr2012$academics$program$bachelors)
#yr2012$academics$program$bachelors
#length(id_data$ope8_id)
```

At this point, the challenge of collecting data directly from the API seemed insurmountable, but we sought a solution and turned to the sage of all data science obstacles: Google.

## The `rscorecard` and `tidyverse` approach

As expected, we found out savior in the annals of algorithmic wisdom when we stumbled upon a package called {rscorecard}.

The {rscorecard} package is a wrapper for the College Scorecard API that takes full advantage of the complexity in this relational data structure by employing useful tools from the tidyverse eco-system. Using {dplyr} functions, specified to this data set, and pipe operators `%>%` from {magrittr}, the {rscorecard} package provides an astonishingly simple solution for querying data directly from the API.

```{r}
#install.packages("rscorecard")
library(rscorecard)
```

The package works by accessing the API directly using the users API key as an argument in the `sc_key()` function.

```{r}
sc_key(APIKey)
```
As the message above states, once the API key is accessed, the user can append querying functions like `sc_filter()`, to collect observations that satisfy booleans, `sc_select()`, to subset the data by columns, and `sc_year()`, to select the data from a specified year.

These functions are mentioned and explained here because they what we use to extract data on **Finances**, **Demographics**, and **Death Rates** from schools that classify as **R1** and **R2** research institutions.

## Finances



```{r}
F_latest <- sc_init() %>%
    sc_filter(distanceonly == 0, ccbasic %in% c(15, 16)) %>%
    sc_select(control, instnm, ccbasic, stabbr, npt4_pub, npt4_priv, costt4_a, grad_debt_mdn, avgfacsal, unemp_rate) %>% 
    sc_year("latest") %>% 
    sc_get()

F_2018 <- sc_init() %>%
    sc_filter(distanceonly == 0, ccbasic %in% c(15, 16)) %>%
    sc_select(control, instnm, ccbasic, stabbr, npt4_pub, npt4_priv, costt4_a, grad_debt_mdn, avgfacsal, unemp_rate) %>% 
    sc_year(2018) %>% 
    sc_get()

F_2017 <- sc_init() %>%
    sc_filter(distanceonly == 0, ccbasic %in% c(15, 16)) %>%
    sc_select(control, instnm, ccbasic, stabbr, npt4_pub, npt4_priv, costt4_a, grad_debt_mdn, avgfacsal, unemp_rate) %>%
    sc_year(2017) %>% 
    sc_get()

F_2016 <- sc_init() %>%
    sc_filter(distanceonly == 0, ccbasic %in% c(15, 16)) %>%
    sc_select(control, instnm, ccbasic, stabbr, npt4_pub, npt4_priv, costt4_a, grad_debt_mdn, avgfacsal, unemp_rate) %>% 
    sc_year(2016) %>% 
    sc_get()

F_2015 <- sc_init() %>%
    sc_filter(distanceonly == 0, ccbasic %in% c(15, 16)) %>%
    sc_select(control, instnm, ccbasic, stabbr, npt4_pub, npt4_priv, costt4_a, grad_debt_mdn, avgfacsal, unemp_rate) %>% 
    sc_year(2015) %>% 
    sc_get()
```

```{r}
F_latest %>% mutate(year = "latest")
F_2018 %>% mutate(year = 2018)
F_2017 %>% mutate(year = 2017)
F_2016 %>% mutate(year = 2016)
F_2015 %>% mutate(year = 2015)

Finance <- rbind(F_latest, F_2018, F_2017, F_2016, F_2015)
```

```{r}
write.csv(Finance, "Proj1Data/Financials15to19.csv")
```

## Demographics

```{r}
D_latest <- sc_init() %>%
    sc_filter(distanceonly == 0, ccbasic %in% c(15, 16)) %>%
    sc_select(control, instnm, ccbasic, stabbr,female, first_gen, poverty_rate, veteran, unemp_rate, ugds_white, ugds_black, ugds_hisp, ugds_asian, ugds_aian, ugds_nhpi, ugds_2mor, ugds_nra, ugds_unkn, ugds_whitenh, ugds_blacknh, ugds_api, ugds_aianold, ugds_hispold) %>% 
    sc_year("latest") %>% 
    sc_get()

D_2018 <- sc_init() %>%
    sc_filter(distanceonly == 0, ccbasic %in% c(15, 16)) %>%
    sc_select(control, instnm, ccbasic, stabbr, female, first_gen, poverty_rate, veteran, unemp_rate, ugds_white, ugds_black, ugds_hisp, ugds_asian, ugds_aian, ugds_nhpi, ugds_2mor, ugds_nra, ugds_unkn, ugds_whitenh, ugds_blacknh, ugds_api, ugds_aianold, ugds_hispold) %>% 
    sc_year(2018) %>% 
    sc_get()

D_2017 <- sc_init() %>%
    sc_filter(distanceonly == 0, ccbasic %in% c(15, 16)) %>%
    sc_select(control, instnm, ccbasic, stabbr, female, first_gen, poverty_rate, veteran, unemp_rate, ugds_white, ugds_black, ugds_hisp, ugds_asian, ugds_aian, ugds_nhpi, ugds_2mor, ugds_nra, ugds_unkn, ugds_whitenh, ugds_blacknh, ugds_api, ugds_aianold, ugds_hispold) %>%
    sc_year(2017) %>% 
    sc_get()

D_2016 <- sc_init() %>%
    sc_filter(distanceonly == 0, ccbasic %in% c(15, 16)) %>%
    sc_select(control, instnm, ccbasic, stabbr, female, first_gen, poverty_rate, veteran, unemp_rate, ugds_white, ugds_black, ugds_hisp, ugds_asian, ugds_aian, ugds_nhpi, ugds_2mor, ugds_nra, ugds_unkn, ugds_whitenh, ugds_blacknh, ugds_api, ugds_aianold, ugds_hispold) %>% 
    sc_year(2016) %>% 
    sc_get()

D_2015 <- sc_init() %>%
    sc_filter(distanceonly == 0, ccbasic %in% c(15, 16)) %>%
    sc_select(control, instnm, ccbasic, stabbr, female, first_gen, poverty_rate, veteran, unemp_rate, ugds_white, ugds_black, ugds_hisp, ugds_asian, ugds_aian, ugds_nhpi, ugds_2mor, ugds_nra, ugds_unkn, ugds_whitenh, ugds_blacknh, ugds_api, ugds_aianold, ugds_hispold) %>% 
    sc_year(2015) %>% 
    sc_get()
```

```{r}
D_latest %>% mutate(year = "latest")
D_2018 %>% mutate(year = 2018)
D_2017 %>% mutate(year = 2017)
D_2016 %>% mutate(year = 2016)
D_2015 %>% mutate(year = 2015)

Demographics <- rbind(D_latest, D_2018, D_2017, D_2016, D_2015)
```

```{r}
write.csv(Demographics, "Proj1Data/Demographics15to19.csv")
```

```{r}
Dth_latest <- sc_init() %>%
    sc_filter(distanceonly == 0, ccbasic %in% c(15, 16)) %>%
    sc_select(control, instnm, ccbasic, stabbr, death_yr2_rt, lo_inc_death_yr2_rt, md_inc_death_yr2_rt,  hi_inc_death_yr2_rt, death_yr3_rt, lo_inc_death_yr3_rt, md_inc_death_yr3_rt, hi_inc_death_yr3_rt, death_yr4_rt, lo_inc_death_yr4_rt, md_inc_death_yr4_rt, hi_inc_death_yr4_rt, death_yr6_rt, lo_inc_death_yr6_rt, md_inc_death_yr6_rt, hi_inc_death_yr6_rt, death_yr8_rt, lo_inc_death_yr8_rt, md_inc_death_yr8_rt, hi_inc_death_yr8_rt) %>% 
    sc_year("latest") %>% 
    sc_get()

Dth_2018 <- sc_init() %>%
    sc_filter(distanceonly == 0, ccbasic %in% c(15, 16)) %>%
    sc_select(control, instnm, ccbasic, stabbr,death_yr2_rt, lo_inc_death_yr2_rt, md_inc_death_yr2_rt,  hi_inc_death_yr2_rt, death_yr3_rt, lo_inc_death_yr3_rt, md_inc_death_yr3_rt, hi_inc_death_yr3_rt, death_yr4_rt, lo_inc_death_yr4_rt, md_inc_death_yr4_rt, hi_inc_death_yr4_rt, death_yr6_rt, lo_inc_death_yr6_rt, md_inc_death_yr6_rt, hi_inc_death_yr6_rt, death_yr8_rt, lo_inc_death_yr8_rt, md_inc_death_yr8_rt, hi_inc_death_yr8_rt) %>% 
    sc_year(2018) %>% 
    sc_get()

Dth_2017 <- sc_init() %>%
    sc_filter(distanceonly == 0, ccbasic %in% c(15, 16)) %>%
    sc_select(control, instnm, ccbasic, stabbr, death_yr2_rt, lo_inc_death_yr2_rt, md_inc_death_yr2_rt,  hi_inc_death_yr2_rt, death_yr3_rt, lo_inc_death_yr3_rt, md_inc_death_yr3_rt, hi_inc_death_yr3_rt, death_yr4_rt, lo_inc_death_yr4_rt, md_inc_death_yr4_rt, hi_inc_death_yr4_rt, death_yr6_rt, lo_inc_death_yr6_rt, md_inc_death_yr6_rt, hi_inc_death_yr6_rt, death_yr8_rt, lo_inc_death_yr8_rt, md_inc_death_yr8_rt, hi_inc_death_yr8_rt) %>%
    sc_year(2017) %>% 
    sc_get()

Dth_2016 <- sc_init() %>%
    sc_filter(distanceonly == 0, ccbasic %in% c(15, 16)) %>%
    sc_select(control, instnm, ccbasic, stabbr, death_yr2_rt, lo_inc_death_yr2_rt, md_inc_death_yr2_rt,  hi_inc_death_yr2_rt, death_yr3_rt, lo_inc_death_yr3_rt, md_inc_death_yr3_rt, hi_inc_death_yr3_rt, death_yr4_rt, lo_inc_death_yr4_rt, md_inc_death_yr4_rt, hi_inc_death_yr4_rt, death_yr6_rt, lo_inc_death_yr6_rt, md_inc_death_yr6_rt, hi_inc_death_yr6_rt, death_yr8_rt, lo_inc_death_yr8_rt, md_inc_death_yr8_rt, hi_inc_death_yr8_rt) %>% 
    sc_year(2016) %>% 
    sc_get()

Dth_2015 <- sc_init() %>%
    sc_filter(distanceonly == 0, ccbasic %in% c(15, 16)) %>%
    sc_select(control, instnm, ccbasic, stabbr, death_yr2_rt, lo_inc_death_yr2_rt, md_inc_death_yr2_rt,  hi_inc_death_yr2_rt, death_yr3_rt, lo_inc_death_yr3_rt, md_inc_death_yr3_rt, hi_inc_death_yr3_rt, death_yr4_rt, lo_inc_death_yr4_rt, md_inc_death_yr4_rt, hi_inc_death_yr4_rt, death_yr6_rt, lo_inc_death_yr6_rt, md_inc_death_yr6_rt, hi_inc_death_yr6_rt, death_yr8_rt, lo_inc_death_yr8_rt, md_inc_death_yr8_rt, hi_inc_death_yr8_rt) %>% 
    sc_year(2015) %>% 
    sc_get()
```

```{r}
Dth_latest %>% mutate(year = "latest")
Dth_2018 %>% mutate(year = 2018)
Dth_2017 %>% mutate(year = 2017)
Dth_2016 %>% mutate(year = 2016)
Dth_2015 %>% mutate(year = 2015)

Death <- rbind(Dth_latest, Dth_2018, Dth_2017, Dth_2016, Dth_2015)
```

```{r}
write.csv(Death, "Proj1Data/Death15to19.csv")
```


```{r}
R1Schools <- sc_init() %>%
    sc_filter(ccbasic == 15) %>%
    sc_select(control, instnm, stabbr) %>% 
    sc_year("latest") %>% 
    sc_get()
```


```{r}
#install.packages("maps")
library(maps)
library(usmap)
debtMedian <- Finance %>%
  group_by(stabbr) %>%
  mutate(avgDebt = mean(grad_debt_mdn, na.rm = TRUE)) %>%
  select(stabbr, avgDebt)%>%
  filter(stabbr %notin% c('PR','DC')) %>%
  ungroup()

debtMedian <- as.data.frame(debtMedian)

colnames(debtMedian) <- c("state", "avgDebt")
debtMedian[1]

plot_usmap(data =debtMedian, values = "avgDebt", color = "black") + 
  scale_fill_continuous(
    low = "white", high = "red", name = "Average Debt Median", label = scales::comma
  ) + theme(legend.position = "right")
```

```{r}
FacSalary <- Finance %>%
  group_by(stabbr) %>%
  mutate(avgSal = mean(avgfacsal, na.rm = TRUE)) %>%
  select(stabbr, avgSal) %>%
  filter(stabbr %notin% c('PR','DC')) %>%
  ungroup()

FacSalary <- as.data.frame(FacSalary)

colnames(FacSalary) <- c("state", "avgSal")

plot_usmap(data =FacSalary, values = "avgSal", color = "black") + 
  scale_fill_continuous(low = "white", high = "blue", name = "Average Faculty Salary", label = scales::comma) + theme(legend.position = "right")
```

```{r}
Finance %>% filter(year == "lastest")
```



<!--chapter:end:02-ImportMethods.Rmd-->


# Data Clean

```{r}

library(tidyverse)

```


```{r}

dem <- read.csv("Proj1Data/Demographics15to19.csv")
dem_clean <- dem[,-c(1, 17, 20:24)] %>%
  rename("university" = instnm,
  "r_status" = ccbasic, 
  "state" = stabbr, 
  "white" = ugds_white, 
  "black" = ugds_black, 
  "hispanic" = ugds_hisp, 
  "asian" = ugds_asian, 
  "indigenous" = ugds_aian, 
  "nhpi" = ugds_nhpi, 
  "nra" = ugds_nra, 
  "unknown" = ugds_unkn) %>% 
  drop_na(black)

dem_clean$r_status <- recode(dem_clean$r_status, `15` = 'R1', `16` = "R2")

dem_clean <- dem_clean %>%  
  group_by(r_status) %>%
  mutate_at(c("female", "first_gen", "poverty_rate", "veteran", "unemp_rate"), funs(ifelse(is.na(.), mean(., na.rm = TRUE),.)))

```


```{r}

write.csv(dem_clean, "cleanDemographics1519.csv")

```



<!--chapter:end:03-cleanDemographics.Rmd-->

# Analysis

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Import
```{r, message=FALSE}
library(moments)
library(dplyr)
library(tidyr)
library(stats)
library(sjstats)
library(ggplot2)
```

```{r}
fin <- read.csv('Proj1Data/Financials15to19.csv')
temp <- read.csv("Proj1Data/Demographics15to19.csv")
death <- read.csv("Proj1Data/Death15to19.csv")
```

## Transform Datasets
```{r}
dem <- temp[,-(20:24)]
finR <- fin[fin$ccbasic == c(15,16) & fin$X < 267,]
finR1 <- fin[fin$ccbasic == 15 & fin$X < 267,]
finR2 <- fin[fin$ccbasic == 16 & fin$X < 267,]
demR <- dem[dem$ccbasic == c(15,16) & dem$X < 267,]
demR1 <- dem[dem$ccbasic == 15 & dem$X < 267,]
demR2 <- dem[dem$ccbasic == 16 & dem$X < 267,]
```

## Descriptive time!
```{r}
# Demographics
summary(demR1$ugds_white)
skewness(demR1$ugds_white)
kurtosis(demR1$ugds_white)

summary(demR2$ugds_white)
skewness(demR2$ugds_white)
kurtosis(demR2$ugds_white)

# Cost
print('Tuition cost')
summary(finR1$costt4_a)
hist(finR1$costt4_a)
summary(finR2$costt4_a)
hist(finR2$costt4_a)

# Students debt
print('Student debt')
summary(finR1$grad_debt_mdn)
hist(finR1$grad_debt_mdn)
summary(finR2$grad_debt_mdn)
hist(finR2$grad_debt_mdn)

# Unemployment
print('Unemployment Rate')
summary(finR1$unemp_rate)
hist(finR1$unemp_rate)
summary(finR2$unemp_rate)
hist(finR2$unemp_rate)
```

# Wilcox for skewed bois
```{r}
# R1 associated with student outcomes
# debt, skewed to all hell so non parametric t-test.  
wilcox.test(formula=finR$grad_debt_mdn~finR$ccbasic)
# debt for R2 unis significantly differed from R1 students.

# non-working
t.test(finR$unemp_rate~finR$ccbasic)
```

```{r}
# cost differences between R1, R2.

# t.test(finR$costt4_a~finR$ccbasic)

# Cant do a t-test cause of the bimodal abomination

# Average annual R1 tuition cost: 41,571.97
# Average annual R2 tuition cost: 33,958.16
```

```{r}
# white people proportion and unemployment

cor(demR$ugds_white, finR$unemp_rate, use = 'complete.obs')

# results: White proportion is negatively associated with unemployment (r = -0.49)
```

## Main model
```{r}
ggplot(finR, aes(unemp_rate, demR$ugds_white,colour=ccbasic)) + geom_point() + geom_smooth(method = "lm")
```

```{r}
# 3 White proportion moderates unemployment outcomes. 
predictor <- finR$ccbasic
moderator <- demR$ugds_white
interaction <- predictor * moderator
outcome <- finR$unemp_rate

wlm <- lm(formula = outcome ~ predictor + moderator + interaction)
summary(wlm)
```

### Decomposition

#### Simple model
```{r}
predictor <- finR$ccbasic
outcome <- finR$unemp_rate
simplelm <- lm(formula = outcome ~ predictor)
summary(simplelm)
```

#### Moderator direct effect
```{r}
predictor <- demR$ugds_white
outcome <- finR$unemp_rate
moderatorlm <- lm(formula = outcome ~ predictor)
summary(moderatorlm)
```

#### Interaction Effect
```{r}
predictor <- finR$ccbasic
moderator <- demR$ugds_white
interaction <- predictor * moderator
outcome <- finR$unemp_rate

interactionlm <- lm(formula = outcome ~ interaction)
summary(moderatorlm)
```

```{r}
# cost differences between R1, R2.

# t.test(finR$costt4_a~finR$ccbasic)

# Cant do a t-test cause of the bimodal abomination

# Average annual R1 tuition cost: 41,571.97
# Average annual R2 tuition cost: 33,958.16
```

```{r}
# white people proportion and unemployment

cor(demR$ugds_white, finR$unemp_rate, use = 'complete.obs')

# results: White proportion is negatively associated with unemployment (r = -0.49)
```

```{r}
# 3 White proportion moderates unemployment outcomes. 
predictor <- finR$ccbasic
moderator <- demR$ugds_white
interaction <- predictor * moderator
outcome <- finR$unemp_rate

wlm <- lm(formula = outcome ~ predictor + moderator + interaction)
wlm
plot(predictor, outcome, type="n")
abline(-6.5218, 0.67)
#abline(y, x, lty=2, col="red")

#points(predictor[finR$ccbasic==15], outcome[finR$ccbasic==16])
# points(predictor[race==1], outcome[race==1], col="red")
```

<!--chapter:end:04-Analysis.Rmd-->

# Final Words

```{r}
library(plotly)

g <- list(
  scope = 'usa',
  projection = list(type = 'albers usa'),
  lakecolor = toRGB('white')
)

avgs <- distinct(FacSalary)

plot_geo() %>%
  add_trace(
    z = ~avgs$avgSal,
    span = I(0),
    colorscale = 'matter',
    locations = avgs$stabbr, 
    locationmode = 'USA-states'
  ) %>%
  colorbar(title = NULL) %>%
  layout(geo = g, title = "Avg. Faculty Salary by State (in USD)")
```

```{r}

avgDM <- distinct(debtMedian)

plot_geo() %>%
  add_trace(
    z = ~avgDM$avgDebt,
    span = I(0),
    colorscale = 'viridis',
    locations = avgDM$state, 
    locationmode = 'USA-states'
  ) %>%
  colorbar(title = NULL) %>%
  layout(geo = g, title = "Avg. Faculty Salary by State (in USD)")
```



<!--chapter:end:05-Visualizations.Rmd-->

`r if (knitr:::is_html_output()) '
# References {-}
'`

<!--chapter:end:06-references.Rmd-->

